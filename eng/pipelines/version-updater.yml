pool:
  vmImage: 'windows-2019'

resources:
  repositories:
    - repository: azure-sdk-tools
      type: github
      name: Azure/azure-sdk-tools
      endpoint: azure
      ref: refs/tags/azure-sdk-tools_20210527.1

variables:
  ChangedPackagesPath: $(Build.ArtifactStagingDirectory)/ChangedPackages.json

steps:
- checkout: self
- checkout: azure-sdk-tools

- task: PowerShell@2
  displayName: Update packages from package manager
  inputs:
    pwsh: true
    filePath: ./azure-sdk/eng/scripts/Query-Azure-Packages.ps1

- task: PowerShell@2
  displayName: Update packages from sdk release data
  inputs:
    pwsh: true
    filePath: ./azure-sdk/eng/scripts/Update-Release-Versions.ps1
    arguments: >
      -github_pat '$(azuresdk-github-pat)'
      -changedPackagesPath $(ChangedPackagesPath)

- pwsh: |
    $fileContent = Get-Content -Path $(ChangedPackagesPath) -Raw
    Write-Host $fileContent